var Angel=function(){function t(t,e,i){var a=this;this.vida=3,this.velocidad=3,this.imagenCargada=!1,this.img=new Image,this.img.src=t,this.img.onload=function(){a.imagenCargada=!0},this.x=e,this.y=i}return t.prototype.draw=function(t){var e=this;this.imagenCargada?t.drawImage(this.img,this.x,this.y):requestAnimationFrame(function(){e.draw(t)})},t.prototype.disparar=function(t){t.push(new Bala(this.x+20,this.y))},t.prototype.muerte=function(){this.vida-=1},t}(),Demonio=function(){function t(t,e,i,a,n){this.x=t,this.y=e,this.velocidadX=i,this.velocidadY=a,this.img=new Image,this.img.src=n,this.direction=-1}return t.prototype.update=function(){this.y+=this.velocidadY,(this.x<=0||this.x>=canvas.width-40)&&(this.direction*=-1),this.x+=this.velocidadX*this.direction},t.prototype.draw=function(t){this.update(),t.drawImage(this.img,this.x,this.y,40,40),this.damageJesus(jesus,t)},t.prototype.collidesWithBullet=function(t){return this.x<t.x+2&&this.x+40>t.x&&this.y<t.y+5&&this.y+40>t.y},t.prototype.collidesWithJesus=function(t){return this.x<t.x+40&&this.x+40>t.x&&this.y<t.y+40&&this.y+40>t.y},t.prototype.damageJesus=function(t,e){if(this.collidesWithJesus(t)){var i=demonios.indexOf(this);-1!==i&&demonios.splice(i,1),t.muerte()}},t}(),Bala=function(){function t(t,e){this.speed=3,this.x=t,this.y=e}return t.prototype.move=function(){this.y-=this.speed},t.prototype.draw=function(t){t.fillStyle="yellow",t.fillRect(this.x,this.y,2,5)},t}(),jesus=new Angel("juego/jesus.png",5,5),demonios=[],canvas=document.getElementById("juegodoo"),anchuraCanvas=canvas.width,alturaCanvas=canvas.height,cruz=new Image;if(cruz.src="juego/lacruz.png",canvas){var t,e=canvas.getContext("2d");if(e){var i=canvas.getBoundingClientRect();canvas.addEventListener("mousemove",function(t){var e=t.clientX-i.left,a=t.clientY-i.top;jesus.x=clamp(e,0,canvas.width-40),jesus.y=clamp(a,0,canvas.height-40)});var a=[];function n(){if(e.clearRect(0,0,canvas.width,canvas.height),e.fillStyle="black",e.fillRect(0,0,canvas.width,canvas.height),jesus.draw(e),a.forEach(function(t,i){t.move(),t.draw(e);var n=[];demonios.forEach(function(e,o){e.collidesWithBullet(t)&&(n.push(o),a.splice(i,1))}),n.forEach(function(t){demonios.splice(t,1),score+=10}),t.y<0&&a.splice(i,1)}),demonios.forEach(function(t){t.update(),t.draw(e)}),drawHealthCrosses(e,jesus.vida),drawScore(e),jesus.vida<3&&(e.fillStyle="white",e.font="20px Arial",e.textAlign="center",e.fillText("JES\xdaS HA RESUCITADO",canvas.width/2,canvas.height/2-20),jesus.vida<2&&(e.fillText("JES\xdaS ES REY",canvas.width/2,canvas.height/2+20),jesus.vida<1)))return acabar(e);t=requestAnimationFrame(n)}canvas.addEventListener("click",function(){jesus.disparar(a)}),n()}else console.log("error con ctx")}else console.log("error con canvas");var intervalo=setInterval(addDemonio,500);function clamp(t,e,i){return Math.min(Math.max(t,e),i)}function drawHealthCrosses(t,e){for(var i=0;i<e;i++){var a=10+25*i;t.drawImage(cruz,a,10,20,20)}}var score=0;function drawScore(t){var e=canvas.width-10;t.font="".concat(15,"px ").concat("Pixelade"),t.fillStyle="white",t.textAlign="right",t.fillText("Puntos: ".concat(score),e,25)}function addDemonio(){var t=[{nombre:"El diablo",velocidadX:.5,velocidadY:.3,ruta:"juego/eldiablo.png"},{nombre:"YHVH",velocidadX:2,velocidadY:.2,ruta:"juego/yhvh.png"},{nombre:"Meteorito",velocidadX:.2,velocidadY:1.3,ruta:"juego/meteorito.png"},{nombre:"ATU",velocidadX:.5,velocidadY:.5,ruta:"juego/atu.png"}],e=t[Math.floor(Math.random()*t.length)],i=e.velocidadX,a=e.velocidadY,n=e.ruta,o=Math.max(0,Math.min(canvas.width-50,Math.random()*canvas.width)),s=new Demonio(o,40,i,a,n);demonios.push(s)}function acabar(t){t.clearRect(0,0,canvas.width,canvas.height),t.fillStyle="white",t.fillRect(0,0,canvas.width,canvas.height),clearInterval(intervalo),t=null;var e=document.getElementById("contenedor");e.style.position="fixed",e.style.top="50px",e.style.left="0",e.style.width="100%",e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="center",e.removeChild(canvas);var i=document.createElement("div");i.textContent="JES\xdaS VOLVER\xc1. INSERTA TU NOMBRE",i.style.marginBottom="10px",e.appendChild(i);var a=document.createElement("input");a.type="text",a.placeholder="Tu nombre",a.style.marginBottom="10px",e.appendChild(a);var n=document.createElement("button");n.textContent="Enviar",e.appendChild(n),n.addEventListener("click",function(){var t=a.value,o=score,s=new Date;e.removeChild(a),e.removeChild(n);var r=s.toISOString().slice(0,10);console.log("Fecha de hoy:",r),fetch("http://localhost:8069/exorcismo/insertar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,date:r,score:o})}).then(function(t){return t.json()}).then(function(t){console.log(t),t.success?i.textContent="Datos insertados correctamente.":i.textContent="Fallo al insertar los datos."}).catch(function(t){console.error("Error:",t),i.textContent="Fallo al insertar los datos."})})}