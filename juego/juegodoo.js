var Angel=function(){function t(t,e,a){var i=this;this.vida=3,this.velocidad=3,this.imagenCargada=!1,this.img=new Image,this.img.src=t,this.img.onload=function(){i.imagenCargada=!0},this.x=e,this.y=a}return t.prototype.draw=function(t){var e=this;this.imagenCargada?t.drawImage(this.img,this.x,this.y):requestAnimationFrame((function(){e.draw(t)}))},t.prototype.disparar=function(t){t.push(new Bala(this.x+20,this.y))},t.prototype.muerte=function(){this.vida-=1},t}(),Demonio=function(){function t(t,e,a,i,n){this.x=t,this.y=e,this.velocidadX=a,this.velocidadY=i,this.img=new Image,this.img.src=n,this.direction=-1}return t.prototype.update=function(){this.y+=this.velocidadY,(this.x<=0||this.x>=canvas.width-40)&&(this.direction*=-1),this.x+=this.velocidadX*this.direction},t.prototype.draw=function(t){this.update();t.drawImage(this.img,this.x,this.y,40,40),this.damageJesus(jesus,t)},t.prototype.collidesWithBullet=function(t){return this.x<t.x+2&&this.x+40>t.x&&this.y<t.y+5&&this.y+40>t.y},t.prototype.collidesWithJesus=function(t){return this.x<t.x+40&&this.x+40>t.x&&this.y<t.y+40&&this.y+40>t.y},t.prototype.damageJesus=function(t,e){if(this.collidesWithJesus(t)){var a=demonios.indexOf(this);-1!==a&&demonios.splice(a,1),t.muerte()}},t}(),Bala=function(){function t(t,e){this.speed=3,this.x=t,this.y=e}return t.prototype.move=function(){this.y-=this.speed},t.prototype.draw=function(t){t.fillStyle="yellow",t.fillRect(this.x,this.y,2,5)},t}(),jesus=new Angel("juego/jesus.png",5,5),demonios=[],canvas=document.getElementById("juegodoo"),anchuraCanvas=canvas.width,alturaCanvas=canvas.height,cruz=new Image;if(cruz.src="juego/lacruz.png",canvas){var animar,ctx_1=canvas.getContext("2d");if(ctx_1){var canvasRect_1=canvas.getBoundingClientRect();canvas.addEventListener("mousemove",(function(t){var e=t.clientX-canvasRect_1.left,a=t.clientY-canvasRect_1.top;jesus.x=clamp(e,0,canvas.width-40),jesus.y=clamp(a,0,canvas.height-40)}));var balas_1=[];function dibujar(){if(ctx_1.clearRect(0,0,canvas.width,canvas.height),ctx_1.fillStyle="black",ctx_1.fillRect(0,0,canvas.width,canvas.height),jesus.draw(ctx_1),balas_1.forEach((function(t,e){t.move(),t.draw(ctx_1);var a=[];demonios.forEach((function(i,n){i.collidesWithBullet(t)&&(a.push(n),balas_1.splice(e,1))})),a.forEach((function(t){demonios.splice(t,1),score+=10})),t.y<0&&balas_1.splice(e,1)})),demonios.forEach((function(t){t.update(),t.draw(ctx_1)})),drawHealthCrosses(ctx_1,jesus.vida),drawScore(ctx_1),jesus.vida<3&&(ctx_1.fillStyle="white",ctx_1.font="20px Arial",ctx_1.textAlign="center",ctx_1.fillText("JESÚS HA RESUCITADO",canvas.width/2,canvas.height/2-20),jesus.vida<2&&(ctx_1.fillText("JESÚS ES REY",canvas.width/2,canvas.height/2+20),jesus.vida<1)))return acabar(ctx_1);animar=requestAnimationFrame(dibujar)}canvas.addEventListener("click",(function(){jesus.disparar(balas_1)})),dibujar()}else console.log("error con ctx")}else console.log("error con canvas");var intervalo=setInterval(addDemonio,500);function clamp(t,e,a){return Math.min(Math.max(t,e),a)}function drawHealthCrosses(t,e){for(var a=0;a<e;a++){var i=10+25*a;t.drawImage(cruz,i,10,20,20)}}var score=0;function drawScore(t){var e=canvas.width-10;t.font="".concat(15,"px ").concat("Pixelade"),t.fillStyle="white",t.textAlign="right",t.fillText("Puntos: ".concat(score),e,25)}function addDemonio(){var t=[{nombre:"El diablo",velocidadX:.5,velocidadY:.3,ruta:"juego/eldiablo.png"},{nombre:"YHVH",velocidadX:2,velocidadY:.2,ruta:"juego/yhvh.png"},{nombre:"Meteorito",velocidadX:.2,velocidadY:1.3,ruta:"juego/meteorito.png"},{nombre:"ATU",velocidadX:.5,velocidadY:.5,ruta:"juego/atu.png"}],e=t[Math.floor(Math.random()*t.length)],a=e.velocidadX,i=e.velocidadY,n=e.ruta,o=Math.max(0,Math.min(canvas.width-50,Math.random()*canvas.width)),s=new Demonio(o,40,a,i,n);demonios.push(s)}function acabar(t){t.clearRect(0,0,canvas.width,canvas.height),t.fillStyle="white",t.fillRect(0,0,canvas.width,canvas.height),clearInterval(intervalo),t=null;var e=document.getElementById("contenedor");e.style.position="fixed",e.style.top="50px",e.style.left="0",e.style.width="100%",e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="center",e.removeChild(canvas);var a=document.createElement("div");a.textContent="JESÚS VOLVERÁ. INSERTA TU NOMBRE",a.style.marginBottom="10px",e.appendChild(a);var i=document.createElement("input");i.type="text",i.placeholder="Tu nombre",i.style.marginBottom="10px",e.appendChild(i);var n=document.createElement("button");n.textContent="Enviar",e.appendChild(n),n.addEventListener("click",(function(){var t=i.value,o=score,s=new Date;e.removeChild(i),e.removeChild(n);var c=s.toISOString().slice(0,10);console.log("Fecha de hoy:",c),fetch("http://localhost:8069/exorcismo/insertar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,date:c,score:o})}).then((function(t){return t.json()})).then((function(t){console.log(t),t.success?a.textContent="Datos insertados correctamente.":a.textContent=" "})).catch((function(t){console.error("Error:",t),a.textContent=" "}))}))}